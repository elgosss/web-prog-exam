<!DOCTYPE html> 
<html>
    <head> 
        <meta charset="UTF-8">
        <title>Измерение атмосферного давления</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <div id="main">
            <div class="content">
                <div class="tabs">
                    <nav class="tabs_items">
                        <a href="#tab_main" class="tabs_item"><span>Главная</span></a>
                        <a href="#tab_tasks" class="tabs_item"><span>Задачи</span></a>
                        <a href="#tab_animation" class="tabs_item"><span>Анимация</span></a>
                        <a href="#tab_model" class="tabs_item"><span>Модель</span></a>
                        <a href="#tab_video" class="tabs_item"><span>Видеоуроки</span></a>
                        <a href="#tab_test" class="tabs_item"><span>Тест</span></a>
                        <a href="#tab_feedback" class="tabs_item"><span>Обратная связь</span></a>
                        <a href="#tab_books" class="tabs_item"><span>Книги</span></a>
                        <a href="#tab_reg" class="tabs_item"><span>Регистрация</span></a>
                        <a href="#tab_login" class="tabs_item"><span>Вход</span></a>
                    </nav>
                    <div class="tabs_body">
                        <div id="tab_main" class="tabs_block">
                            <section class="layers">
                                <div class="layers_container">
                                    <div class="layers_item layer-1" style="background-image: url(scene.jpg);"></div>
                                    <div class="layers_item layer-2" style="font-weight: 900; font-size: 60px;">АТМОСФЕРНОЕ ДАВЛЕНИЕ</div>
                                    <div class="layers_item layer-3" style="background-image: url(layer-4.png);"></div>
                                    <div class="layers_item layer-4" style="background-image: url(layer-5.png);"></div>
                                </div>
                            </section>
                        </div>

                        <div id="tab_tasks" class="tabs_block">
                            Нормальное атмосферное давление при t = 0°C - 760 мм. рт. ст. <br>
                            На каждые 12 метров давление уменьшается на 1 мм. ртутного столба. <br>
                            <br>
                            <b>Задача №1</b><br>
                            Определите глубину шахты, если на дне ее барометр показывает 109 297 Па, а на поверхности Земли 103 965 Па. <br>
                            <div class="decision_accordion">Решение</div>
                            <div class="decision">
                                Каждые 12 метров вниз увеличивают давление на 133,3 Па.<br>
                                Δp = p1 - p2<br>
                                Δp = 109 297 Па - 103 965 Па = 5332 Па - разность давлений на этих высотах<br>
                                n = 5332 Па / 133,3 Па = 40 - количество интревалов по 12 м каждый<br>
                                h = 40 * 12 м =  480 м<br>
                                Ответ: h = 480 м
                            </div>
                            <br>
                            <b>Задача №2</b><br>
                            У подножья горы барометр показывает 742 мм. рт. ст., а на ее вершине 90 317 Па. Определите высоту горы.<br>
                            <div class="decision_accordion">Решение</div>
                            <div class="decision">
                                Переводи все в одну систему единиц давления, например, в мм. рт. ст.<br>
                                90 317 Па = 90 317 Па / 133,3 Па = 678 мм. рт. ст.<br>
                                Находим разность давлений<br>
                                Δp = 742 мм. рт. ст. - 678 мм. рт. ст. = 64 мм. рт. ст.<br>
                                Давление изменилось на 64 мм. рт. ст. А так как каждый 1 мм. рт. ст. соответствует 12 метрам, то высота горы<br>
                                h = 64 * 12 м = 768 м<br>
                                Ответ: h = 768 м
                            </div>
                            <br>
                            <b>Задача №3</b><br>
                            Какое давление покажет барометр на шпиле Эйфелевой башни, высота которого h = 325 м, если атмосферное давление в Париже нормальное, то есть p1 = 100 000 Па.<br>
                            <div class="decision_accordion">Решение</div>
                            <div class="decision">
                                Определяем сколько раз в значение высоты башни входит величина 12 м<br>
                                n = 325 / 12 м = 27<br>
                                На каждых 12 м вверх происходит уменьшение давления атмосферы на 133,3 Па. Тогда находим, насколько изменяется давление атмосферы на найденном интервале<br>
                                Δp = 27 * 133,3 Па = 3610 Па<br>
                                Значит, на высоте шпиля башни давление будет<br>
                                p2 = p1 - Δp<br>
                                p2 = 100 000 Па - 3610 Па = 96 390 Па<br>
                                Ответ: p2 = 96 390 Па
                            </div> 
                            <br>
                            <b>Задача №4</b><br>
                            Определите давление газа в баллоне, если разность уровней ртути в манометре Δh = 200 мм. Атмосферное давление нормальное.<br>
                            <div class="decision_accordion">Решение</div>
                            <div class="decision">
                                p газа = p атм + p ртути<br>
                                p ртути = ρgh<br>
                                p ртути = 13 600 кг/м3 * 10 H/кг * 0,2 м = 27 200 Па<br>
                                p атм = 100 000 Па<br>
                                p газа = 27 200 Па + 100 000 Па = 127 200 Па = 127,2 кПа<br>
                                Ответ: p газа = 127,2 кПа
                            </div>
                            <br>
                            <b>Задача №5</b><br>
                            Оределите атмосферное давление, если на уровне a давление газа в колбе на ртуть pa = 181 кПа. Плотность ртути ρ = 13 600 кг/м3.<br>
                            <div class="decision_accordion">Решение</div>
                            <div class="decision">
                                p газа = p атм + p ртути<br>
                                p газа = pa = 181 кПа = 181 000 Па<br>
                                p ртути = ρgh<br>
                                p ртути = 13 600 кг/м3 * 10 H/кг * 0,6 м = 81 600 Па<br>
                                p атм = p газа - p ртути<br>
                                p атм = 181 000 Па - 81 600 Па = 99 400 Па = 99,4 кПа<br>
                                Ответ: p газа = 99,4 кПа
                            </div>
                        </div>

                        <div id="tab_animation" class="tabs_block">
                            <div id="tube_animation" class="tube">
                                <div id="stopper_animation" class="stopper"></div>
                                <div id="glass_tube_animation" class="glass_tube"></div>
                                <div id="funnel_animation" class="funnel"></div>
                                <div id="tube_r_animation" class="tube_r"></div>
                                <div id="tube_bottom_animation" class="tube_bottom"></div>
                                <div id="tube_l_animation" class="tube_l"></div>
                                <div id="water_l_animation" class="water_l"></div>
                                <div id="water_r_animation" class="water_r"></div>
                            </div>
                        </div>

                        <div id="tab_model" class="tabs_block">
                            <div id="tube_model" class="tube">
                                <div id="stopper_model" class="stopper"></div>
                                <div id="glass_tube_model" class="glass_tube"></div>
                                <div id="funnel_model" class="funnel"></div>
                                <div id="tube_r_model" class="tube_r"></div>
                                <div id="tube_bottom_model" class="tube_bottom"></div>
                                <div id="tube_l_model" class="tube_l"></div>
                                <div id="water_l_model" class="water_l"></div>
                                <div id="water_r_model" class="water_r"></div>
                            </div>
                            <div id="model_result">
                                <div id="model_l"></div><br>
                                <button id="model_btn" class="hidden">Рассчитать</button>
                            </div>
                        </div>

                        <div id="tab_video" class="tabs_block">
                            Видеоуроки
                        </div>

                        <div id="tab_test" class="tabs_block">
                            <div id="test">
                                <div id="test_progress">
                                    <div class="test_progress_inner"></div>
                                </div>
                                <div id="test_question">Вопрос</div>
                                <ul id="test_options">
                                    <li class="test_option">1</li>
                                    <li class="test_option">2</li>
                                    <li class="test_option">3</li>
                                    <li class="test_option">4</li>
                                </ul>
                                <div id="test_bottom">
                                    <div id="test_page" style="margin-top: 30px;">0 / 10</div>
                                    <button id="test_next_btn">Следующий</button>
                                </div>
                            </div>
                            <div id="test_result" class="hidden">
                                <img src="theEnd.png" width="239.2px" style="margin-bottom: 20px;" alt="">
                                Тест завершен!
                                <div id="test_score" style="margin-top: 20px;">Вы набрали 10 баллов</div>
                                <button id="test_restart">Начать заново</button>
                            </div>
                        </div>

                        <div id="tab_feedback" class="tabs_block">
                            <form id="feedback">
                                <div>
                                    <img src="fbCorgi.gif" width="239.2px" style="margin-bottom: 20px; border-radius: 50%;" alt="">
                                </div>
                                <label for="fb_name">Имя</label><br>
                                <input type="text" name="fb_name" id="fb_name"><br>

                                <label for="fb_surname">Фамилия</label><br>
                                <input type="text" name="fb_surname" id="fb_surname"><br>

                                <label for="fb_phone">Телефон</label><br>
                                <input type="text" name="fb_phone" id="fb_phone"><br>

                                <label for="fb_email">Адрес эл. почты</label><br>
                                <input type="email" name="fb_email" id="fb_email"><br>
                                
                                <textarea name="fb_text" id="fb_text" placeholder="Введите текст"></textarea>

                                <button type="button" id="fb_form">Отправить</button>
                                <div id="fb_status"></div>
                            </form>
                        </div>

                        <div id="tab_books" class="tabs_block">
                            Книги
                        </div>

                        <div id="tab_reg" class="tabs_block">
                            <form onsubmit="reg()" id="reg">
                                <div class="avatar">
                                    <img src="avatarCorgi.png" width="239.2px" style="margin-bottom: 20px;" alt="">
                                </div>

                                <label for="reg_name">Имя</label><br>
                                <input type="text" name="reg_name" id="reg_name"><br>

                                <label for="reg_username">Логин</label><br>
                                <input type="text" name="reg_username" id="reg_username"><br>

                                <label for="reg_email">Адрес эл. почты</label><br>
                                <input type="email" name="reg_email" id="reg_email"><br>

                                <label for="reg_password">Пароль</label><br>
                                <input type="password" name="reg_password" id="reg_password"><br>

                                <button type="submit">Зарегистрироваться</button>

                                <p id="reg_text">Зарегистрируйтесь в системе</p>
                            </form>
                        </div>

                        <div id="tab_login" class="tabs_block">
                            <form onsubmit="login()" id="login">
                                <div class="avatar">
                                    <img src="loginCorgi.gif" width="239.2px" style="margin-bottom: 20px; border-radius: 50%;" alt="">
                                </div>

                                <label for="login_username">Логин</label><br>
                                <input type="text" name="login_username" id="login_username"><br>

                                <label for="login_password">Пароль</label><br>
                                <input type="password" name="login_password" id="login_password"><br>

                                <button type="submit">Войти</button>

                                <p id="login_text">Войдите в систему</p>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <script src="questions.js"></script>
        <script>
            "use strict";
            
            // ЗАДАЧИ
            $('.decision_accordion').each((key, el) => {
                el.addEventListener('click', () => {
                    let decision = el.nextElementSibling;

                    if (decision.style.maxHeight) {
                        decision.style.maxHeight = null;
                    } else {
                        decision.style.maxHeight = decision.scrollHeight + 'px';
                    }
                })
            });

            // РЕГ
            var arr_users = JSON.parse(localStorage.getItem('users'));
            if (arr_users == null) arr_users = [];

            var storage_users = [];

            function reg(e) {
                event.preventDefault();
                
                var reg_name = $('#reg_name').val(),
                    reg_username = $('#reg_username').val(),
                    reg_email = $('#reg_email').val(),
                    reg_password = $('#reg_password').val(),
                    reg_text = $('#reg_text');

                class user {
                    constructor(name, username, email, password) {
                        this.name = name;
                        this.username = username;
                        this.email = email;
                        this.password = password;
                    }
                }

                var unique_username = true;
                for (let i = 0; i < arr_users.length; i++) {
                    if (reg_username == arr_users[i].username) {
                        unique_username = false;
                    }
                }

                if (reg_name.length < 1) {
                    reg_text.html('Не введено имя!');
                    reg_text.css('color', '#de1212');
                } else if (reg_username.length < 1) {
                    reg_text.html('Не введен логин!');
                    reg_text.css('color', '#de1212');
                } else if (reg_email.length < 1) {
                    reg_text.html('Не введен адрес эл.почты!');
                    reg_text.css('color', '#de1212');
                } else if (reg_password.length < 1) {
                    reg_text.html('Не введен пароль!');
                    reg_text.css('color', '#de1212');
                } else if (reg_password.length < 8) {
                    reg_text.html('Слишком слабый пароль, <br> должно быть не менее <br> 8 символов!');
                    reg_text.css('color', '#de1212');
                } else if (unique_username == false) {
                    reg_text.html('Такой логин уже занят!');
                    reg_text.css('color', '#de1212');
                } else {
                    reg_text.html(reg_name + ', Вы успешно зарегистрированы!');
                    reg_text.css('color', '#fff');

                    $('#reg_name').val('');
                    $('#reg_username').val('');
                    $('#reg_email').val('');
                    $('#reg_password').val('');

                    arr_users.push(new user(reg_name, reg_username, reg_email, reg_password));
                    localStorage.setItem('users', JSON.stringify(arr_users));
                }
                
                storage_users = JSON.parse(localStorage.getItem('users'));
                console.log(storage_users);
            }
            
            // ВХОД
            function login(e) {
                event.preventDefault();

                var login_username = $('#login_username').val(),
                    login_password = $('#login_password').val(),
                    login_text = $('#login_text'),
                    login_name;

                var successful_login = false;
                    
                console.log(arr_users);
                arr_users.forEach((el) => {
                    if (el.username == login_username && el.password == login_password) {
                        successful_login = true;
                        login_name = el.name;
                    }
                });

                if (login_username.length < 1 || login_password.length < 1) {
                    login_text.html('Вы не заполнили все поля!');
                    login_text.css('color', '#de1212');
                } else if (successful_login == false) {
                    login_text.html('Неправильный логин или пароль!');
                    login_text.css('color', '#de1212');
                } else {
                    login_text.html(login_name + ', Вы успешно вошли!');
                    login_text.css('color', '#fff');
                    $('#login_username').val('');
                    $('#login_password').val('');
                }
            }

            // ОБРАТНАЯ СВЯЗЬ
            $('#fb_form').click(function() {

                $.ajax({
                    type:'POST',
                    url: 'sender.php',
                    data: $(this).serialize()
                }).done(function() {
                    $('#fb_form').html('Форма успешно отправлена!');
                });
                return false;

                //var form = jQuery(this).closest('form');
                
                //var actUrl = form.attr('action');

                // jQuery.ajax({
                //     url: 'sender.php',
                //     type: 'post',
                //     dataType: 'html',
                //     data: form.serialize(),
                //     success: function(data) {
                //         form.find('#fb_status').html('форма отправлена успешно');
                //     },
                //     error:	 function() {
                //         form.find('#fb_status').html('серверная ошибка');
                //     }
                // });
            });

            // ТЕСТ
            var test = $('#test');
            
            let count = 0,  // вопрос в списке
                userScore = 0;  // правильные ответы пользователя
            
            showQuestions(count);
            
            function showQuestions(index) {
                var test_question = $('#test_question'),
                    test_options = $('#test_options'),
                    test_page = $('#test_page'),
                    test_progress = $('.test_progress_inner');

                test_question.html(questions[index].question);

                test_options.html('');
                questions[index].options.forEach(el => {
                    test_options.append(`<li class="test_option">${el}</li>`)
                });

                $('.test_option').each((key, el) => el.setAttribute('onclick', 'optionSelected(this)'));

                test_page.html(`${index + 1} / ${questions.length}`);

                test_progress.css('width', `${Math.round(((index + 1) / questions.length) * 100)}%`);
            }

            function optionSelected(answer) {
                var userAnswer = answer.textContent,
                    correctAnswer = questions[count].answer,
                    test_option = $('.test_option');
                
                if (userAnswer == correctAnswer) {
                    userScore++;
                    answer.classList.add('option_right');
                } else {
                    answer.classList.add('option_wrong');

                    test_option.each((key, el) => {
                        if (el.textContent == correctAnswer) {
                            setTimeout(() => {
                                el.classList.add('option_right');
                            }, 200);
                        }
                    });
                }

                test_option.each((key, el) => el.classList.add('option_disabled'));
            }

            $('#test_next_btn').on('click', function() {
                var test_option = $('.test_option'),
                    test_result = $('#test_result'),
                    test_score = $('#test_score');

                if ((count + 1) == questions.length && test_option.hasClass('option_disabled')) {
                    test_result.removeClass('hidden');
                    test.addClass('hidden');
                    test_score.html(`Вы набрали ${userScore} из ${questions.length} баллов`);
                    return;
                }

                if (test_option.hasClass('option_disabled')) {
                    count++;
                    showQuestions(count);
                } else {
                    alert('Вы ничего не выбрали!');
                }
            })

            $('#test_restart').on('click', function() {
                $('#test_result').addClass('hidden');
                test.removeClass('hidden');

                count = 0;
                userScore = 0;
            
                showQuestions(count);
            })

            // ГЛАВНАЯ
            document.addEventListener('mousemove', e => {
                Object.assign(document.documentElement, {
                    style: `
                    --moveX: ${(e.clientX - window.innerWidth / 2) * - 0.005}deg;
                    --moveY: ${(e.clientY - window.innerWidth / 2) * - 0.01}deg;
                    `
                })
            })

            // МОДЕЛЬ
            var one = true;
            document.addEventListener('keydown', el => {
                var tube_r_model = $('#tube_r_model'),
                    tube_l_model = $('#tube_l_model'),
                    funnel_model = $('#funnel_model'),
                    water_r_model = $('#water_r_model'),
                    water_l_model = $('#water_l_model'),
                    tube_bottom_model = $('#tube_bottom_model'),
                    glass_tube_model = $('#glass_tube_model');
                
                if ($('#model_l').html() == '') {
                    var top_water_l = parseFloat(water_l_model.position().top),
                        top_glass_tube = parseFloat(glass_tube_model.position().top)

                    var l = (top_water_l - top_glass_tube) / 2.75 / 100;    // 110px = 40см
                    $('#model_l').html(`l = ${l.toFixed(4)} м.`);

                    $('#model_btn').removeClass('hidden');
                };

                $('#model_btn').on('click', function() {
                    var del_l = (parseFloat(water_l_model.position().top) - top_water_l) / 2.75 / 100;
                    if (!isNaN(del_l)) {
                        $('#model_l').append(`<br>Δl =  ${del_l.toFixed(4)} м.`);
                        var del_l_plus_l = del_l + l;
                    };
                    if (one) {
                        var h = (parseFloat(water_r_model.position().top) - parseFloat(tube_l_model.position().top)) / 60 + del_l;
                        $('#model_l').append(`<br>h =  ${h.toFixed(4)} м.`);    // 60px = 1m

                        var ρ = 1000,
                            g = 9.81;

                        var p = ρ * g * h * del_l_plus_l / del_l;

                        one = false;
                    }
                    
                });
                
                switch(el.keyCode) {
                    case 40: {  // стрелка вниз
                        if (water_l_model.height() > 0) {

                            tube_r_model.animate({top: '+=6'}, 10);
                            tube_r_model.animate({height: '-=3.5'}, 10);

                            funnel_model.animate({top: '+=6'}, 10);

                            water_r_model.animate({top: '+=6'}, 10);

                            tube_bottom_model.animate({top: '+=2.5'}, 10);

                            tube_l_model.animate({height: '+=2.5'}, 10);

                            water_l_model.animate({top: '+=1.5'}, 10);
                            water_l_model.animate({height: '-=1.5'}, 10);
                        }
                        break;
                    }
                    case 38: {  // стрелка вверх
                        if (funnel_model.position().top > 0) {

                            tube_r_model.animate({top: '-=6'}, 10);
                            tube_r_model.animate({height: '+=3.5'}, 10);

                            funnel_model.animate({top: '-=6'}, 10);

                            water_r_model.animate({top: '-=6'}, 10);

                            tube_bottom_model.animate({top: '-=2.5'}, 10);

                            tube_l_model.animate({height: '-=2.5'}, 10);

                            water_l_model.animate({top: '-=1.5'}, 10);
                            water_l_model.animate({height: '+=1.5'}, 10); 
                        }
                        break;
                    }
                    default: break;
                }
            });
            
        </script>
    </body>
</html>